<script src="//code.jquery.com/jquery.js"></script>
<% if (theme.bootstrap_js) { %>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<% } %>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/js/bootstrap.min.js"></script>
<script src="<%- config.root %>js/respond.min.js"></script>
<%- partial('google_analytics') %>
<% if (theme.imagesloaded_js) { %>
<script src="//cdn.jsdelivr.net/imagesloaded/3.0.4/imagesloaded.pkgd.js"></script>
<% } %>
<% if (config.disqus_shortname){ %>
<script type="text/javascript">
var disqus_shortname = '<%= config.disqus_shortname %>';
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/<% if (page.comments){ %>embed.js<% } else { %>count.js<% } %>';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>
<% } %>
<% if (theme.fancybox){ %>
<link rel="stylesheet" href="<%- config.root %>fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="<%- config.root %>fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>
<% } %>
<script>
function getArrayFromTable(element){
	var array = [[]];
  
  $(element).find("th").each(function(index, item) {
    array[0].push($(item).html());
  });

  $(element).find("tr").has('td').each(function() {
    array.push([]);
    var index = array.length-1;
    $('td', $(this)).each(function(i, item) {
      var value = $(item).html()
      array[index].push(parseFloat(value) || value);
    });
  });
  
  return array;
}

function drawCharts() {

	$('chart').each(function(index, element){
    var table = element.nextElementSibling; 
    
    var tableTable = getArrayFromTable(table);
    var data = google.visualization.arrayToDataTable(tableTable);
    
    var jsonOptions = element.getAttribute('options').replace(/'/g, '"')
    
    var options = JSON.parse(jsonOptions);
    var type = stringToFunction('google.visualization.' + element.getAttribute('type'));
    var chart = new type($(element).find("div")[0]);
    chart.draw(data, options);
    
    $(table).hide()
  });
  
}

var stringToFunction = function(str) {
  var arr = str.split(".");

  var fn = (window || this);
  for (var i = 0, len = arr.length; i < len; i++) {
    fn = fn[arr[i]];
  }

  if (typeof fn !== "function") {
    throw new Error("function not found");
  }

  return fn;
};

google.setOnLoadCallback(drawCharts);

</script>